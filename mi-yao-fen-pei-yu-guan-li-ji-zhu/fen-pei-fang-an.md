# 密钥分配方案

解决的是网络环境中需要进行安全通信的实体间的建立共享的密钥问题  
需要解决的两方面问题：  
1. 为减轻负担，提高效率，引入自动密钥分配机制  
2. 为提高安全性，尽可能减少系统中驻留的密钥数

### 方案

#### 对称密码分配

* ##### 集中式密钥分配方案

  由**密钥分配中心KDC**，或者由一组节点组成层次结构，负责密钥的产生并分配给通信双方。  
  由密钥分配中心KDC，或者由一组节点组成层次结构负责密钥的产生并分配给通信双方。  
  用户不需要保存大量的会话密钥，只需要保存同KDC通信的加密密钥  
  通信量大，要求具有较好的鉴别功能以鉴别KDC和通信方
> 假定A、B分别与KDC有一个共享的密钥Ka和Kb，A希望与B建立一个逻辑连接，并且需要一次性会话密钥来保护经过这个连接传输的数据。
>步骤1：AKDC ： IDA//IDB//N1
说明：A向KDC发出会话密钥请求。请求的消息由两个数据项组成：
1、A和B的身份IDA和IDB
2、本次业务的唯一标识符N1（每次请求所用的N1都应不同，常用一个时间戳、一个计数器或一个随机数作为这个标识符）
*为防止攻击者对N1的猜测，用随机数更为合适
> 步骤2：KDCA：EKa[Ks//IDA//IDB//N1//EKb[Ks//IDA]]
说明：KDC对A的请求发出应答。应答由密码Ka加密的信息，因此只有A才能成功对其解密，并且A相信信息的确是由KDC发出。
信息中包括A希望得到的两项数据：（1）一次性会话密钥Ks；（2）A在步骤1中发出的请求，包括一次性随机数N1
信息中包括B希望得到的两项数据：（1）一次性会话密钥Ks；（2）A的身份IDA。这两项将由Kb加密，由A发送给B。
>步骤3：AB：EKb[Ks//IDA]
说明：A收到KDC的消息后，同时将会话密钥Ks存储起来，同时将经过KDC与B共享密钥加密后的信息发送给B。
B收到后，得到会话 Ks，并从IDA中知道对方是A，而且还从Ekb知道Ks确实来自KDC。
由于A转发的是加密后的密文，所以转发过程不会被窃听
——步骤3处，已经完成了密钥的分配
>步骤4：BA：EKs[N2]
说明：B用会话密钥加密另一个随机数N2，并将加密结果发送给A，并告诉A：B当前是可以通信的
>步骤5：AB：EKs[f(N2)]
说明：A响应B发送的信息N2，并对N2进行某种函数变换，同时用会话密钥Ks进行加密，发送给B
——步骤4、5结合步骤3执行的是认证功能，使B能够确认所收到的信息不是一个重放。


* ##### 分布式密钥分配方案

  网络通信中各个通信方具有相同的地位，它们之间的密钥分配取决于它们之间的协商，不受任何其他方的限制
  >网络通信中，各个通信方具有相同的地位，它们之间的密钥分配取决于它们之间的协商，不受任何其他方的限制。
n个通信方，需要保存n(n-1)/2个主密钥
不适合规模较大的网络应用
>步骤1：AB：IDA//N1
说明：A向B发出一个要求会话密钥的请求，内容包括：
 A的身份标识符IDA
 一个随机数N1
目的：表明A希望与B通信，并请B产生一个会话密钥用于安全通信
>步骤2： B  A ：EMKm[Ks//IDA//IDB//f(N1)//N2]
说明：B使用与A共享的主密钥MKm对应答的信息进行加密并发送给A。应答信息的内容包括：
 B产生的会话密钥Ks
A的身份标识符IDA
B的身份标识符IDB
 f(N1)和一个一次性随机数N2
>步骤3： A  B ：EKs[f(N2)]
说明： A 使用B产生的会话密钥Ks对 f(N2)进行加密，并发送给B


* ##### 混合密钥分配方案

  上层采用分布式密钥分配方案，而上层对于终端或它所属的通信子网采用集中式密钥分配方案

#### 非对称密码分配

* ##### 公钥的分配
* ##### 利用非对称密码技术进行对称密码技术密钥的分配

### 基本方法

##### 方法一

密钥由A选定，然后通过物理方法安全地传送给B

##### 方法二

密钥由可信赖的第三方C选取，并通过物理方法安全地传送给A、B

——这两种方法不适合现代通信（因为密钥需要人工传送）

##### 方法三

如果A和B事先已有一密钥，那么其中一方选取新密钥后，用已有的密钥加密新密钥后发送给对方

——由于要对所有的用户分配初始密钥，代价大，也不适合现代通信

##### 方法四

如果A和B都有一个到可信赖的第三方C的保密信道，那么C就可以为A和B选取密钥后安全地发送给A和B

——可信赖的第三方C就是密钥分配中心KDC，常用于对称密码技术的密钥分配

##### 方法五

如果A和B都在可信赖的第三方C发布自己的公开密钥，那么他们用彼此的公开密钥进行保密通信

——采用密钥认证中心技术，可信赖的第三方C就是证书授权中心CA，常用于非对称密码技术的公钥分配

